<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="../css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/programList.css}" href="../css/programList.css" rel="stylesheet">
</head>
<body>
<div th:replace="/layout/nav.html :: nav"></div>
<div class="container" style="max-width: 800px">
    <br>
    <div class="input-group searchDiv">
        <input class="form-control h-25" type="text" placeholder="검색어 입력" id="enterKeyword" autofocus>
        <button type="button" id="searchBtn" th:style="|background-image: url(@{/img/icon-search.png})|" onclick="search()"></button>
    </div>
    <div id="searchText" style="clear: both"></div>
    <hr>
    <th:block th:each="program: ${list}">
        <div class="row" th:onclick="|location.href='@{/program/{programNum}(programNum=${program.programNum})}'|">
            <div class="col-3 imgDiv" style="width: 150px; margin-left: 12px">
                <img th:if="${program.filename != null}" th:src="@{'/files/' + ${program.filename}}" style="width: 100%; height: 200px">
                <div id="noImg" style="height: 200px;" th:unless="${program.filename != null}">No Image</div>
            </div>
            <div class="col" id="textDiv">
                <div>
                    <span class="badge bg-secondary">[[${program.type}]]</span>
                    <span class="badge bg-secondary" th:if="${#dates.createToday().before(program.startDate)}">예정</span>
                    <span class="badge bg-secondary" th:if="${#dates.createToday().after(program.endDate)}">마감</span>
                    <span class="badge bg-secondary" th:if="${#dates.createToday().compareTo(program.startDate) >= 0} and ${program.endDate.compareTo(#dates.createToday()) >= 0}">진행</span>
                </div>
                <p th:text="${program.title}"></p>
                <p>[[${program.startDate}]] ~ [[${program.endDate}]] </p>
                <p th:text="${program.place}"></p>
            </div>
        </div>
        <hr>
    </th:block>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script>
    window.addEventListener("load", function () {
        const params = new URLSearchParams(location.search);
        const keyword = params.get("keyword");

        document.getElementById("searchText").innerHTML = "<h4><b>" + keyword + "</b> 검색결과</h4>";
    })

    document.getElementById("enterKeyword").addEventListener("keydown", function (e) {
        if(e.key === "Enter") {
            search();
        }
    })

    function search() {
        let k = document.getElementById("enterKeyword").value;

        if(k.trim().length !== 0)
            location.href = '/program/search?keyword=' + k;
        else
            alert("검색어를 입력해주세요");
    }
</script>
</body>
</html>